<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Messenger: @Rekz Banz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background-color: #19124e;
      color: #fefeff;
    }
    h1 { color: #fefeff; }

    h3 { color: #dedef4; font-size: 16px; font-weight: normal;}
    
    button {
      padding: 15px 30px;
      font-size: 20px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover { background-color: #0056b3; }
    button:disabled { background-color: #ccc; cursor: default; }
    .question { margin-bottom: 25px; }
    .correct { color: #00ff88; font-weight: bold; }
    .wrong { color: #ff5577; font-weight: bold; }
    .highlight { margin-top: 10px; }
    input[type="radio"] { transform: scale(1.5); margin-right: 10px; }
    #finishBtn { font-size: 2em; padding: .1em 1em; }
    .nav-buttons { margin-top: 20px; display: flex; gap: 10px; }

    #codeInput {
      font-size: 15px;
      padding: 10px 20px;
      width: 265px;
      border-radius: 8px;
      border: 2px solid #888;
    }

    #codeInput::placeholder { font-size: 15px; }

    /* Smaller font for Enter Access Code */
    #accessSection h2 {
      font-size: 1.2em;
      margin-bottom: 10px;
    }

    /* Style for filename display above access code */
    #fileDisplay {
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 5px;
      color: #9fe3ff;
    }
  </style>
</head>

<body>
  <div id="accessSection">
    <p id="fileDisplay"></p> <!-- NEW filename display -->
    <h3>Enter Access Code: '12345'</h3>
    <div style="position:relative; display:inline-block;">
      <input type="password" id="codeInput" placeholder="Enter code here"
        style="padding-right:45px;">
    
      <span id="toggleEye"
        style="
          position:absolute;
          right:12px;
          top:50%;
          transform:translateY(-50%);
          cursor:pointer;
          font-size:20px;
          color:#9fe3ff;
          user-select:none;
        "
      >üëÅÔ∏è</span>
    </div>
    
    <br>
    <button type="button" id="accessSubmit" style="padding:10px 40px; font-size:20px;">Login</button>

    <span id="contactLink" style="margin-left:16px; font-size:14px; text-decoration:underline; cursor:pointer; color:#9fe3ff;">
     Contact here! 
    </span>


    <p id="message" aria-live="polite"></p>
    <br>
    <p id="tipsArea">Loading tips...</p>
  </div>

  <div id="mainContent" style="display:none;">
    <div id="reviewerSection">
      <h1>Reviewer: Hydraulic Pumps

and Cylinders</h1>
 
 
 <section class="reviewer">

  <!-- ==================== GEAR PUMPS ==================== -->
  <details open>
    <summary><strong>1. Gear Pumps</strong></summary>

    <details>
      <summary><em>1.1 External Gear Pumps</em></summary>
      <ul>
        <li><strong>Pumping Mechanism</strong>
          <ul>
            <li>Two external gears mesh and unmesh.</li>
            <li>Fluid is trapped between gear teeth and casing.</li>
            <li>Fluid is carried from inlet to outlet.</li>
          </ul>
        </li>
        <li><strong>Advantages</strong>
          <ul>
            <li>Cheap and easy to manufacture</li>
            <li>Compact design</li>
            <li>Simple construction</li>
          </ul>
        </li>
        <li><strong>Disadvantages</strong>
          <ul>
            <li>Limited pressure capability</li>
            <li>Unbalanced forces cause large bearing loads</li>
            <li>Noisy due to gear mesh</li>
            <li>Fixed displacement</li>
            <li>Volumetric efficiency issues</li>
          </ul>
        </li>
      </ul>
    </details>

    <details>
      <summary><em>1.2 Internal Gear Pumps</em></summary>
      <ul>
        <li><strong>Pumping Mechanism</strong>
          <ul>
            <li>Smaller gear rotates inside a larger gear.</li>
            <li>Meshing and unmeshing creates partial vacuum.</li>
            <li>Crescent divider separates suction and discharge.</li>
          </ul>
        </li>
        <li><strong>Displacement</strong>
          <ul>
            <li>Depends on number of teeth of both gears.</li>
            <li>Also affected by the size of the crescent divider.</li>
          </ul>
        </li>
        <li><strong>Advantages</strong>
          <ul>
            <li>Quieter than external gear pumps</li>
            <li>Reduced gear slap</li>
          </ul>
        </li>
        <li><strong>Disadvantages</strong>
          <ul>
            <li>More difficult to manufacture</li>
            <li>Unbalanced forces remain</li>
            <li>Volumetric efficiency issues</li>
            <li>Fixed displacement</li>
          </ul>
        </li>
      </ul>
    </details>

    <details>
      <summary><em>1.3 Gerotor (Internal Gear Type)</em></summary>
      <ul>
        <li><strong>Mechanism</strong>
          <ul>
            <li>Inner gear is shaft-driven.</li>
            <li>Outer gear is driven by the inner gear.</li>
            <li>Single tooth space displaces fluid.</li>
            <li>Design maintains close tolerances.</li>
          </ul>
        </li>
        <li><strong>Advantages</strong>
          <ul>
            <li>Cheap</li>
            <li>Simple construction</li>
          </ul>
        </li>
        <li><strong>Disadvantages</strong>
          <ul>
            <li>Limited pressure capability</li>
            <li>Unbalanced design</li>
            <li>Fixed displacement</li>
            <li>Often used as a charge pump</li>
          </ul>
        </li>
      </ul>
    </details>

  </details>

  <!-- ==================== VANE PUMPS ==================== -->
  <details>
    <summary><strong>2. Vane Pumps</strong></summary>

    <details>
      <summary><em>2.1 Pumping Mechanism</em></summary>
      <ul>
        <li>Vaned rotor rotates inside a cam ring.</li>
        <li>Van es slide in and out of rotor slots.</li>
        <li>Volume change creates suction and discharge.</li>
      </ul>
    </details>

    <details>
      <summary><em>2.2 Vane Pump Variations</em></summary>
      <ul>
        <li>Balanced vane pump designs reduce bearing loads.</li>
        <li>Variable displacement vane pumps adjust flow output.</li>
      </ul>
    </details>

    <details>
      <summary><em>2.3 Advantages</em></summary>
      <ul>
        <li>Quieter than gear pumps</li>
        <li>Higher pressure capability</li>
        <li>Replaceable cartridge design</li>
        <li>Easier maintenance</li>
      </ul>
    </details>

  </details>

  <!-- ==================== GENERAL NOTES ==================== -->
  <details>
    <summary><strong>3. General Characteristics of Hydraulic Pumps</strong></summary>
    <ul>
      <li>Pumps convert mechanical energy into hydraulic energy.</li>
      <li>Positive displacement pumps move a fixed amount of fluid per cycle.</li>
      <li>Noise, efficiency, pressure capability vary by pump type.</li>
    </ul>
  </details>

</section>
 
 
 
 
      <button onclick="showQuiz()">Start Quiz</button>
    </div>

    <div id="quizSection" style="display:none;">
      <h1>Quiz: Hydraulic Pumps

and Cylinders</h1>
      <p style="font-size: 15px; font-weight: 600; margin: 0;">Multiple-Choice Quiz (random items)</p>
      <form id="quizForm"></form>

      <div class="nav-buttons">
        <button id="finishBtn">Score</button>
        <button type="button" onclick="refreshQuiz()">Restart Quiz</button>
        <button type="button" onclick="backToReviewer()">Reviewer</button>
      </div>
      <div id="result" class="highlight"></div>
    </div>
  </div>

<!-- CONTACT POPUP MODAL -->
<div id="contactModalBG" style="
  display:none; 
  position:fixed; 
  top:0; left:0; 
  width:100%; height:100%; 
  background:rgba(0,0,0,0.6); 
  z-index:1000;
">
  <div id="contactModal" style="
    background:#ffffff; 
    color:#000; 
    width:90%; 
    max-width:450px; 
    margin:80px auto; 
    padding:25px; 
    border-radius:12px; 
    box-shadow:0 0 15px rgba(0,0,0,0.5);
  ">

    <h2 style="margin-top:0; font-size:22px; text-align:center;">
      Fill-in with your details here. <br>I'll contact you shortly!
    </h2>

    <label>Name:</label>
    <input id="c_name" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Contact No.:</label>
    <input id="c_contact" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Social Media Account:</label>
    <input id="c_social" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Request / Comment:</label>
    <textarea id="c_request" style="width:100%; padding:8px; margin-bottom:10px; height:80px;"></textarea>

    <button id="c_submit" style="
      width:100%; padding:10px; 
      background:#007BFF; color:#fff; border:none; border-radius:6px;
      margin-top:10px; font-size:18px;
    ">Submit</button>

    <button id="c_close" style="
      width:100%; padding:10px; 
      background:#444; color:#fff; border:none; border-radius:6px;
      margin-top:10px; font-size:18px;
    ">Close</button>
<!--
    <p style="margin-top:20px; font-size:20px; text-align:center; color:#333;">
      or you can contact this messenger: <b>@Rekz Banz</b>
    </p>
-->

  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
    // ===== SHOW / HIDE PASSWORD TOGGLE =====
    const toggleEye = document.getElementById("toggleEye");
  const codeInputEye = document.getElementById("codeInput");

  toggleEye.addEventListener("click", () => {
    if (codeInputEye.type === "password") {
      codeInputEye.type = "text";
      toggleEye.textContent = "üôà"; // hide icon
    } else {
      codeInputEye.type = "password";
      toggleEye.textContent = "üëÅÔ∏è"; // show icon
    }
  });

  // ===== Display filename on login page =====
  const quizTitleEl = document.querySelector("#quizSection h1");
  const displayFileName = quizTitleEl ? quizTitleEl.textContent.replace("Quiz: ", "").trim() : "index.html";
  const fileDisplay = document.getElementById("fileDisplay");
  if (fileDisplay) fileDisplay.textContent = displayFileName;

  // ===== SETTINGS =====
  const BIN_URL_CODE = "https://api.jsonbin.io/v3/b/68ec7ba7d0ea881f409fea07/latest";
  const BIN_URL_TIPS = "https://api.jsonbin.io/v3/b/68f1b652ae596e708f180d5d/latest";
  const MASTER_KEY_CODE = "$2a$10$CvK4w8DTXZ1//5H1cpGQIerIT8Kzvk0FQHosdNm.XS0Q9n6sMmaf6";
  const MASTER_KEY_TIPS = "$2a$10$CvK4w8DTXZ1//5H1cpGQIerIT8Kzvk0FQHosdNm.XS0Q9n6sMmaf6";

  // === LOGGER BIN (Access Log) ===
  const BIN_URL_LOG = "https://api.jsonbin.io/v3/b/6911a123d0ea881f40df102a";
  const MASTER_KEY_LOG = MASTER_KEY_CODE;

  // === SCORE LOG BIN (New) ===
  const BIN_URL_SCORE = "https://api.jsonbin.io/v3/b/6912985cd0ea881f40e0cf7c";
  const MASTER_KEY_SCORE = MASTER_KEY_CODE;

  // ===== ELEMENTS =====
  const accessSection = document.getElementById("accessSection");
  const mainContent = document.getElementById("mainContent");
  const codeInput = document.getElementById("codeInput");
  const accessSubmit = document.getElementById("accessSubmit");
  const message = document.getElementById("message");
  const tipsArea = document.getElementById("tipsArea");

// ===============================
// CONTACT MODAL LOGIC (WORKING)
// ===============================

// open modal
const contactLink = document.getElementById("contactLink");
const contactBG = document.getElementById("contactModalBG");
const contactClose = document.getElementById("c_close");
const contactSubmit = document.getElementById("c_submit");

if (contactLink && contactBG) {
  contactLink.addEventListener("click", () => {
    contactBG.style.display = "block";
  });
}

if (contactClose && contactBG) {
  contactClose.addEventListener("click", () => {
    contactBG.style.display = "none";
  });
}
// ===============================
// CONTACT SUBMISSION SAVE LOGIC
// ===============================
const BIN_CONTACT_LOG = "https://api.jsonbin.io/v3/b/69146372d0ea881f40e3989e";
const MASTER_KEY_CONTACT = MASTER_KEY_CODE;

if (contactSubmit) {
  contactSubmit.addEventListener("click", async () => {
    const name = document.getElementById("c_name").value.trim();
    const contact = document.getElementById("c_contact").value.trim();
    const social = document.getElementById("c_social").value.trim();
    const request = document.getElementById("c_request").value.trim();

    if (!name || !contact || !request) {
      alert("Please fill out name, contact, and request/comment.");
      return;
    }

    const quizTitleElLocal = document.querySelector("#quizSection h1");
    const fileName = quizTitleElLocal
      ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim()
      : "index.html";

    const deviceInfo = await getDeviceInfo();

    try {
      const getRes = await fetch(`${BIN_CONTACT_LOG}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_CONTACT }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];

      logs.push({
        event: "Client Request",
        request,
        name,
        contact,
        social,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_CONTACT_LOG, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_CONTACT
        },
        body: JSON.stringify(logs)
      });

      alert("Message sent!");
      contactBG.style.display = "none";

    } catch (err) {
      alert("Error sending contact message.");
      console.error(err);
    }
  });
}



  // ===== HELPERS =====
  function findStringKey(obj, keyName) {
    if (!obj || typeof obj !== "object") return undefined;
    for (const k in obj) {
      if (k.toLowerCase() === keyName.toLowerCase() && typeof obj[k] === "string") {
        return obj[k];
      }
      const v = obj[k];
      if (typeof v === "object") {
        const nested = findStringKey(v, keyName);
        if (nested) return nested;
      }
    }
  }

  async function getDeviceInfo() {
    const uaData = navigator.userAgentData || {};
    const ua = navigator.userAgent;
    const platform = navigator.platform;
    const language = navigator.language;
    const screenResolution = `${window.screen.width}x${window.screen.height}`;
    const browserVersion = uaData.brands
      ? uaData.brands.map(b => `${b.brand} ${b.version}`).join(", ")
      : ua;

    // Determine general device type
    const uaLower = ua.toLowerCase();
    let deviceType = "desktop";
    if (/mobi|iphone|android/i.test(uaLower)) {
      deviceType = "mobile";
    } else if (/tablet|ipad|nexus 7|nexus 10/i.test(uaLower)) {
      deviceType = "tablet";
    }

    // Get approximate IP + region/country info (non-identifying)
    let networkInfo = "Unavailable";
    try {
      const res = await fetch("https://ipapi.co/json/");
      if (res.ok) {
        const info = await res.json();
        networkInfo = {
          ip: info.ip,
          city: info.city,
          region: info.region,
          country: info.country_name,
          org: info.org
        };
      }
    } catch {
      networkInfo = "Network lookup failed";
    }

    // Optional: request geolocation with user consent
    const location = await new Promise(resolve => {
      if (!navigator.geolocation) return resolve("Geolocation not supported");
      navigator.geolocation.getCurrentPosition(
        pos => resolve({
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
          accuracy: pos.coords.accuracy
        }),
        () => resolve("Permission denied or unavailable"),
        { timeout: 5000 }
      );
    });

    return {
      ua,
      browserVersion,
      platform,
      language,
      screenResolution,
      deviceType,
      networkInfo,
      location
    };
  }

  async function saveLoginToJsonBin(codeUsed) {
    try {
      // get filename from quiz title h1
      const quizTitleElLocal = document.querySelector("#quizSection h1");
      const fileName = quizTitleElLocal ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim() : "index.html";

      const getRes = await fetch(`${BIN_URL_LOG}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_LOG }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];

      const deviceInfo = await getDeviceInfo();

      logs.push({
        event: "Login Access",
        accessCode: codeUsed,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_URL_LOG, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_LOG
        },
        body: JSON.stringify(logs)
      });

      console.log(`‚úÖ Login logged successfully (file: ${fileName}).`);
    } catch (err) {
      console.error("‚ùå Error logging to JSONBin:", err);
    }
  }

  // ===== LOAD TIPS =====
  async function loadTips() {
    try {
      const resp = await fetch(BIN_URL_TIPS, {
        headers: { "X-Master-Key": MASTER_KEY_TIPS, "Content-Type": "application/json" }
      });
      const data = await resp.json();
      const tipsText =
        findStringKey(data, "tips") ||
        "Tips: <br>Press Enter after typing the code.<br>Stay online when entering.<br>For help, contact messenger: @Rekz Banz";
      tipsArea.innerHTML = tipsText;
    } catch (err) {
      console.error("Tips fetch error:", err);
      tipsArea.innerHTML =
        "Could not load page. Please check your internet connection.";
    }
  }
  loadTips();

  // === NEW FUNCTION: Save Quiz Score to JSONBin ===
  async function saveScoreToJsonBin(score, total) {
    try {
      const quizTitleElLocal = document.querySelector("#quizSection h1");
      const fileName = quizTitleElLocal ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim() : "index.html";

      const getRes = await fetch(`${BIN_URL_SCORE}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_SCORE }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];
      const deviceInfo = await getDeviceInfo();

      logs.push({
        event: "Quiz Score",
        score: `${score}/${total}`,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_URL_SCORE, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_SCORE
        },
        body: JSON.stringify(logs)
      });
      console.log("‚úÖ Quiz score saved to JSONBin successfully.");
    } catch (err) {
      console.error("‚ùå Error saving quiz score:", err);
    }
  }

  // ===== LOCAL STORAGE =====
  const fileName = window.location.pathname.split("/").pop() || "default";
  const storageKey = "savedAccessCode_" + fileName.replace(/\W+/g, "_");
  const savedCode = localStorage.getItem(storageKey);
  if (savedCode) codeInput.value = savedCode;
  codeInput.addEventListener("input", () =>
    localStorage.setItem(storageKey, codeInput.value)
  );

  // ===== LOGIN HANDLER =====
  codeInput.addEventListener("keyup", (e) => {
    if (e.key === "Enter") accessSubmit.click();
  });

  accessSubmit.addEventListener("click", async () => {
    const input = codeInput.value.trim();
    if (!input) {
      message.textContent = "Please enter the access code.";
      return;
    }

    accessSubmit.disabled = true;
    codeInput.disabled = true;
    message.textContent = "Checking...";

    try {
      const resp = await fetch(BIN_URL_CODE, {
        headers: { "X-Master-Key": MASTER_KEY_CODE, "Content-Type": "application/json" }
      });

      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();

      const remoteCode =
        findStringKey(data, "accessCode") ||
        findStringKey(data, "code") ||
        findStringKey(data, "access");

      if (!remoteCode) {
        message.textContent = "Access code not found in storage record.";
        throw new Error("No accessCode in JSON");
      }

      if (input === remoteCode.trim()) {
        accessSection.style.display = "none";
        mainContent.style.display = "block";
        message.textContent = "";
        saveLoginToJsonBin(input); // <<== AUTO LOG TO JSONBIN
        setTimeout(() => {
          const btn = document.querySelector("#mainContent button");
          if (btn) btn.focus();
        }, 100);
      } else {
        message.textContent = "Wrong code. Please refer to contact";
        localStorage.removeItem(storageKey);
        accessSubmit.disabled = false;
        codeInput.disabled = false;
      }
    } catch (err) {
      console.error("Access fetch error:", err);
      message.textContent = "Error fetching code. Check console for details.";
      accessSubmit.disabled = false;
      codeInput.disabled = false;
    }
  });

  // ===== QUIZ LOGIC =====
  const pool = [
  

{q: "What type of pump uses two externally meshing gears to move fluid?", choices: ["External gear pump", "Internal gear pump", "Vane pump", "Axial piston pump", "Radial piston pump", "Bent-axis piston pump"], correctIndex: 0},

{q: "Which feature makes external gear pumps inexpensive?", choices: ["Easy to manufacture", "High pressure capability", "Balanced force design", "Variable displacement", "Low noise operation", "Complex internal parts"], correctIndex: 0},

{q: "What is a major disadvantage of external gear pumps?", choices: ["Limited pressure capability", "High manufacturing cost", "Variable displacement instability", "Excessive size", "Poor availability", "Complex control system"], correctIndex: 0},

{q: "What causes large bearing loads in external gear pumps?", choices: ["Unbalanced pressure forces", "Excessive heat generation", "High fluid viscosity", "Cavitation at inlet", "Variable displacement design", "Excessive shaft speed"], correctIndex: 0},

{q: "Which pump type is noted to be noisy due to gear mesh noise?", choices: ["External gear pump", "Internal gear pump", "Vane pump", "Radial piston pump", "Axial piston pump", "Bent-axis pump"], correctIndex: 0},

{q: "What type of displacement do gear pumps generally have?", choices: ["Fixed displacement", "Variable displacement", "Load-sensing displacement", "Pressure-compensated displacement", "Elastic displacement", "Balanced displacement"], correctIndex: 0},

{q: "In an internal gear pump, where does the smaller gear rotate?", choices: ["Within a bigger gear", "Outside the housing", "Against a vane rotor", "Inside a piston block", "Within a cylinder barrel", "Along a bent axis shaft"], correctIndex: 0},

{q: "What component divides liquid flow in an internal gear pump?", choices: ["Crescent", "Vane", "Piston rod", "Cylinder head", "Gear shaft", "Bearing seal"], correctIndex: 0},

{q: "What determines the displacement of an internal gear pump?", choices: ["Number of gear teeth and crescent size", "Fluid temperature", "Pump speed only", "Oil viscosity only", "Bearing size", "Housing thickness"], correctIndex: 0},

{q: "Why are internal gear pumps quieter than external gear pumps?", choices: ["Reduced gear slap", "Lower operating speed", "Use of pistons", "Balanced vane design", "Lower pressure output", "Higher leakage"], correctIndex: 0},

{q: "What is a disadvantage of internal gear pumps compared to external gear pumps?", choices: ["More difficult to manufacture", "Higher noise level", "Lower efficiency only", "Larger size", "No crescent divider", "Higher cost of oil"], correctIndex: 0},

{q: "What issue do both internal and external gear pumps share?", choices: ["Volumetric efficiency issues", "Variable displacement instability", "High cost of cartridges", "Balanced force overload", "Complex control valves", "High vibration damping"], correctIndex: 0},

{q: "Which internal gear pump variation displaces a single tooth space?", choices: ["Gerotor", "External gear", "Balanced vane", "Radial piston", "Axial piston", "Bent-axis piston"], correctIndex: 0},

{q: "In a gerotor pump, which gear is shaft-driven?", choices: ["External (inside) gear", "Internal gear", "Crescent divider", "Outer housing", "Driven idler gear", "Piston block"], correctIndex: 0},

{q: "What is a common application of gerotor pumps?", choices: ["Charge pump", "Main high-pressure system pump", "Elevator actuator", "Construction boom actuator", "Hydraulic press ram", "Rotary actuator"], correctIndex: 0},

{q: "Which is an advantage of gerotor pumps?", choices: ["Simple and cheap design", "High pressure capability", "Balanced forces", "Variable displacement", "Very quiet operation", "High volumetric compensation"], correctIndex: 0},

{q: "What is a disadvantage of gerotor pumps?", choices: ["Limited pressure capability", "Complex manufacturing", "Large physical size", "High noise level", "High cost", "Variable displacement instability"], correctIndex: 0},

{q: "Which pump type uses sliding vanes in its pumping mechanism?", choices: ["Vane pump", "External gear pump", "Internal gear pump", "Axial piston pump", "Radial piston pump", "Bent-axis pump"], correctIndex: 0},

{q: "What design feature allows some vane pumps to have longer life?", choices: ["Balanced design", "Unbalanced pressure", "Fixed displacement only", "High gear mesh", "Single tooth displacement", "Bent-axis configuration"], correctIndex: 0},

{q: "What maintenance advantage do vane pumps offer?", choices: ["Replaceable cartridge rotating group", "Self-lubricating gears", "No moving parts", "Automatic pressure balancing", "Permanent displacement setting", "No seals required"], correctIndex: 0},

{q: "Which pump type commonly offers variable displacement?", choices: ["Vane pump", "External gear pump", "Gerotor pump", "Internal gear pump", "Simple gear pump", "Charge pump"], correctIndex: 0},

{q: "Compared to gear pumps, vane pumps are generally:", choices: ["Quieter", "Noisier", "Less efficient", "Lower pressure capable only", "Cheaper to manufacture", "Always unbalanced"], correctIndex: 0},

{q: "What is a disadvantage of vane pumps?", choices: ["More complex and expensive than gear pumps", "Very limited pressure capability", "Excessive gear noise", "No option for variable displacement", "Poor volumetric efficiency only", "No cartridge replacement"], correctIndex: 0},

{q: "Which piston pump design has pistons arranged parallel to the drive shaft?", choices: ["Axial piston pump", "Radial piston pump", "Bent-axis pump", "Vane pump", "Gerotor pump", "External gear pump"], correctIndex: 0},

{q: "Which piston pump design has pistons arranged perpendicular to the drive shaft?", choices: ["Radial piston pump", "Axial piston pump", "Bent-axis pump", "Vane pump", "Internal gear pump", "External gear pump"], correctIndex: 0},

{q: "Which piston pump design uses an angled shaft relative to the piston block?", choices: ["Bent-axis pump", "Axial piston pump", "Radial piston pump", "Vane pump", "Gerotor pump", "External gear pump"], correctIndex: 0},

{q: "What is another name for a hydraulic cylinder?", choices: ["Linear hydraulic motor", "Rotary hydraulic motor", "Gear actuator", "Vane actuator", "Piston pump", "Charge actuator"], correctIndex: 0},

{q: "What type of motion does a hydraulic cylinder produce?", choices: ["Unidirectional linear motion", "Bidirectional rotary motion", "Oscillating rotary motion", "Continuous rotary motion", "Circular motion", "Angular motion only"], correctIndex: 0},

{q: "What provides power to a hydraulic cylinder?", choices: ["Pressurized hydraulic fluid", "Electrical current", "Compressed air only", "Mechanical springs", "Thermal expansion", "Gravity"], correctIndex: 0},

{q: "What component connects the piston to the external load in a hydraulic cylinder?", choices: ["Piston rod", "Cylinder barrel", "Cylinder cap", "Gland", "Seal ring", "Bearing sleeve"], correctIndex: 0},

{q: "What is the cylinder head also called?", choices: ["Gland", "Cap", "Barrel", "Rod end", "Base plate", "Seal housing"], correctIndex: 0},

{q: "What is the cylinder bottom also called?", choices: ["Cap", "Gland", "Rod end", "Seal head", "Bearing end", "Flange"], correctIndex: 0},

{q: "What divides the inside of the hydraulic cylinder into two chambers?", choices: ["Piston", "Piston rod", "Cylinder head", "Cylinder barrel", "Seal ring", "Bearing"], correctIndex: 0}



  ];

// === UPDATE QUIZ TITLE (selected/total items) ===
function updateQuizTitleCount(selectedCount) {
  const quizTitleEl = document.querySelector("#quizSection h1");
  if (quizTitleEl) {
    const totalItems = pool.filter(item => item && item.q && item.choices).length;
    quizTitleEl.textContent = `Quiz: Hydraulic Pumps

and Cylinders (${selectedCount}/${totalItems} items)`;
  }
}

  function pickRandom(arr, n) {
    const copy = [...arr];
    const result = [];
    while (result.length < n && copy.length > 0) {
      const idx = Math.floor(Math.random() * copy.length);
      result.push(copy.splice(idx, 1)[0]);
    }
    return result;
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function selectRandomChoices(item) {
    const correctChoice = item.choices[item.correctIndex];
    let others = item.choices.filter((_, idx) => idx !== item.correctIndex);
    shuffleArray(others);
    let selected = [correctChoice, ...others.slice(0, 4)];
    shuffleArray(selected);
    item.correctIndex = selected.indexOf(correctChoice);
    item.choices = selected;
  }

  let quizItems = [];

  window.showQuiz = function () {
    document.getElementById("reviewerSection").style.display = "none";
    document.getElementById("quizSection").style.display = "block";
    buildQuiz();
  };

  window.backToReviewer = function () {
    document.getElementById("quizSection").style.display = "none";
    document.getElementById("reviewerSection").style.display = "block";
    document.getElementById("quizForm").innerHTML = "";
    document.getElementById("result").innerHTML = "";
  };

  window.refreshQuiz = function () {
    document.getElementById("quizForm").innerHTML = "";
    document.getElementById("result").innerHTML = "";
    document.getElementById("finishBtn").disabled = false;
    buildQuiz();
  };

  function buildQuiz() {
    quizItems = pickRandom(pool, Math.min(15, pool.length));
    const form = document.getElementById("quizForm");
    form.innerHTML = "";
    quizItems.forEach((item, i) => {
      selectRandomChoices(item);
      const div = document.createElement("div");
      div.className = "question";
      const q = document.createElement("p");
      q.textContent = `${i + 1}. ${item.q}`;
      div.appendChild(q);
      item.choices.forEach((choice, idx) => {
        const label = document.createElement("label");
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = `q${i}`;
        radio.value = idx;
        label.appendChild(radio);
        label.appendChild(document.createTextNode(" " + choice));
        div.appendChild(label);
        div.appendChild(document.createElement("br"));
      });
      form.appendChild(div);
    });
    updateQuizTitleCount(quizItems.length);
  }

  document.getElementById("finishBtn").addEventListener("click", async function () {
    let score = 0;
    const total = quizItems.length;
    for (let i = 0; i < total; i++) {
      const radios = document.querySelectorAll(`input[name="q${i}"]`);
      let selected = -1;
      radios.forEach(r => { if (r.checked) selected = parseInt(r.value); });
      const div = document.getElementById("quizForm").children[i];
      if (selected === quizItems[i].correctIndex) {
        score++;
        div.insertAdjacentHTML("beforeend", "<div class='correct'>‚úî Correct</div>");
      } else {
        const correctAnswer = quizItems[i].choices[quizItems[i].correctIndex];
        div.insertAdjacentHTML("beforeend", `<div class='wrong'>‚úò Wrong. Correct: ${correctAnswer}</div>`);
      }
      radios.forEach(r => r.disabled = true);
    }
    document.getElementById("result").innerHTML = `<h2>Your Score: ${score} / ${total}</h2>`;
    this.disabled = true;

    // üß† Save score to JSONBin
    await saveScoreToJsonBin(score, total);
  });
});
</script>
</body>
</html>


